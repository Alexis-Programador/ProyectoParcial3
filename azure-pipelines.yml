trigger:
- main

pool:
  name: Default
  demands:
    - Agent.Name -equals ALEXIS

variables:
  RESOURCE_GROUP: "demo-from-azure-devops"
  LOCATION: "centralus"
  SQL_SERVER_NAME: "nombre-unico-servidor123"
  DATABASE_NAME: "myDatabase"

steps:
- task: AzureCLI@2
  displayName: 'Desplegar DB usando un pipeline'
  inputs:
    azureSubscription: 'demo-from-azure-devops'
    scriptType: ps
    scriptLocation: inlineScript
    inlineScript: |
      $RESOURCE_GROUP = "$(RESOURCE_GROUP)"
      $LOCATION = "$(LOCATION)"
      $SQL_SERVER_NAME = "$(SQL_SERVER_NAME)"
      $ADMIN_USER = "$(ADMIN_USER)"
      $ADMIN_PASSWORD = "$(ADMIN_PASSWORD)"
      $DATABASE_NAME = "$(DATABASE_NAME)"

      Write-Output "Creando grupo de recursos..."
      az group create --name $RESOURCE_GROUP --location $LOCATION

      Write-Output "Creando servidor SQL..."
      az sql server create `
        --name $SQL_SERVER_NAME `
        --resource-group $RESOURCE_GROUP `
        --location $LOCATION `
        --admin-user $ADMIN_USER `
        --admin-password $ADMIN_PASSWORD

      Write-Output "Creando base de datos..."
      az sql db create `
        --resource-group $RESOURCE_GROUP `
        --server $SQL_SERVER_NAME `
        --name $DATABASE_NAME `
        --service-objective S0

      Write-Output "âœ… Despliegue completado exitosamente"
